<<<<<<< HEAD

# kiwi

Υλοποίηση πολυνηματικής λειτουργίας σε μηχανή αποθήκευσης δεδομένων kiwi

# Multithreaded Data Storage Engine (KIWI)

## Περιγραφή

Η εργασία αφορά τη μετατροπή μιας έτοιμης μηχανής αποθήκευσης δεδομένων (KIWI Engine) σε πολυνηματική εφαρμογή.  
Στόχος είναι η βελτίωση της απόδοσης μέσω ταυτόχρονων λειτουργιών put (write) και get (read), με χρήση της βιβλιοθήκης pthreadS.  
Η υλοποίηση εξασφαλίζει αμοιβαίο αποκλεισμό (mutual exclusion) και σωστό συγχρονισμό (synchronization) μεταξύ των νημάτων.

---

## Αρχιτεκτονική της Μηχανής

Η μηχανή αποτελείται από δύο κύριους φακέλους:
bench/ → Επικοινωνία με το terminal, δημιουργία και διαχείριση νημάτων
engine/ → Εσωτερική λειτουργία της βάσης δεδομένων

### Δομή Engine

| Αρχείο | Περιγραφή |
| `db.cc / db.h` | Διαχείριση βάσης δεδομένων (open, close, add, get) |
| `memtable.cc / memtable.h` | Προσωρινή αποθήκευση δεδομένων στη μνήμη |
| `sst.cc / sst.h` | Διαχείριση αποθήκευσης στον δίσκο & διαδικασία compaction |

---

## Λειτουργίες

### Write (put)

Προσθέτει εγγραφές στη βάση μέσω της `db_add()`.  
Όταν γεμίσει η μνήμη (`memtable`), τα δεδομένα γράφονται στο δίσκο (`sst`) μέσω **compaction** σε ξεχωριστό νήμα.

### Read (get)

Αναζητά δεδομένα αρχικά στη μνήμη (`memtable`) και, αν δεν υπάρχουν, στον δίσκο (`sst`).

### ReadWrite

Μικτή λειτουργία που εκτελεί παράλληλα αναγνώσεις και εγγραφές σε διάφορα ποσοστά:

| Επιλογή | Read | Write |
| 1 | 50% | 50% |
| 2 | 10% | 90% |
| 3 | 60% | 40% |

---

## Πολυνηματική Υλοποίηση

- Χρήση pthreads για τη δημιουργία ανεξάρτητων νημάτων ανά λειτουργία (`put` / `get`).
- Κοινή βάση δεδομένων για όλα τα νήματα.
- Εφαρμογή mutex locks για:
  - Τον έλεγχο πρόσβασης στη βάση.
  - Την αποφυγή συγκρούσεων κατά την ταυτόχρονη πρόσβαση.
  - Τον συγχρονισμό των στατιστικών χρόνου εκτέλεσης.

---

## Reader–Writer Problem

Η πολιτική πρόσβασης επιτρέπει:

- Πολλούς αναγνώστες ταυτόχρονα.
- Έναν μόνο συγγραφέα κάθε φορά.
- Οι συγγραφείς έχουν αποκλειστική πρόσβαση όταν γράφουν.

Η επίλυση επιτεύχθηκε με χρήση locks στις συναρτήσεις:

db_add();
db_get();

Τροποποιήσεις Κώδικα

- bench.cc

Προσθήκη pthread.h και δημιουργία δομής struct dataset για τα ορίσματα των νημάτων.
Συνάρτηση printer() για εμφάνιση στατιστικών.
Δημιουργία νημάτων με pthread_create() και τερματισμός με pthread_join().
Κοινή χρήση db_open() και db_close() για όλα τα νήματα.

- kiwi.cc

Εισαγωγή mutexes για αποφυγή συγκρούσεων στους χρόνους εκτέλεσης:
pthread_mutex_lock(&mymutex);
...
pthread_mutex_unlock(&mymutex);

- db.cc

Προσθήκη κλειδαριών για αναγνώστες και συγγραφείς:
pthread_mutex_t writer;
pthread_mutex_t reader;

Εφαρμογή ελέγχου πρόσβασης ώστε:
Οι writers να εκτελούνται αποκλειστικά.
Οι readers να μπορούν να διαβάζουν ταυτόχρονα.

Τρόπος Εκτέλεσης
1.Μεταγλώττιση
make all

2.Εκτέλεση
./kiwi-bench <λειτουργία> <αριθμός εγγραφών> <αριθμός νημάτων>

Παραδείγματα
./kiwi-bench write 100000 4
./kiwi-bench read 50000 2
./kiwi-bench readwrite 100000 8

Κατά την επιλογή readwrite, ο χρήστης επιλέγει ποσοστό read/write:
1 -> 50% read / 50% write
2 -> 10% read / 90% write
3 -> 60% read / 40% write

Αποτελέσματα & Παρατηρήσεις
Η πολυνηματική προσέγγιση βελτίωσε σημαντικά την απόδοση.
Ο σωστός συγχρονισμός απέτρεψε σφάλματα όπως segmentation faults και race conditions.
Η υλοποίηση Reader–Writer εξασφαλίζει σταθερότητα και ασφάλεια δεδομένων.

---

Συντελεστές
Υλοποίηση: Οδυσσέας Λέτσος
Γλώσσα: C / C++
Βιβλιοθήκη νημάτων: pthreads
Περιβάλλον: Linux / Unix

> > > > > > > restore-master
